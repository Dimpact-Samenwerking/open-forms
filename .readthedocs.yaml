# .readthedocs.yaml
# Read the Docs configuration file
# See https://docs.readthedocs.io/en/stable/config-file/v2.html for details

version: 2

sphinx:
  configuration: docs/conf.py

build:
  os: 'ubuntu-20.04'
  apt_packages:
    - libxml2-dev
    - libxmlsec1-dev
    - libxmlsec1-openssl
    - wget
  tools:
    python: '3.10'
  jobs:
    post_checkout:
      # fetch the changelog from the SDK repository. Docs:
      # https://docs.readthedocs.io/en/stable/environment-variables.html
      - |
        SDK_REF=$(cat .sdk-release | tr -d '[:space:]') # default to the version in .sdk-release file
        case $READTHEDOCS_VERSION_TYPE in
          # external = PR
          external) SDK_REF=main;;
          unknown) SDK_REF=main;;
        esac

        [ "$READTHEDOCS_VERSION_NAME" == "latest" ] && SDK_REF=main

        URL=https://github.com/open-formulieren/open-forms-sdk/raw/${SDK_REF}/CHANGELOG.rst
        wget $URL -O docs/changelog-sdk.rst

python:
  install:
    - requirements: requirements/ci.txt
