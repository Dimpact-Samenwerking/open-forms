# Generated by Django 3.2.20 on 2023-08-02 08:26

from django.db import migrations


def populate_formstep_slugs_from_form_definitions(apps, _):
    """
    This is possible since the form definition slugs are globally unique.
    """
    FormStep = apps.get_model("forms", "FormStep")

    # can't do this in a single query because joins are not permitted
    steps = list(FormStep.objects.select_related("form_definition"))
    for formstep in steps:
        formstep.slug = formstep.form_definition.slug
    FormStep.objects.bulk_update(steps, fields=["slug"])


class Migration(migrations.Migration):

    dependencies = [
        ("forms", "0085_auto_20230802_1025"),
    ]

    operations = [
        migrations.RunPython(
            populate_formstep_slugs_from_form_definitions, migrations.RunPython.noop
        ),
    ]
